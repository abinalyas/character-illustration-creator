{"ast":null,"code":"'use strict';\n\nconst sourceMapGenerator_js = require('source-map-js/lib/source-map-generator.js');\nconst trackNodes = new Set(['Atrule', 'Selector', 'Declaration']);\nfunction generateSourceMap(handlers) {\n  const map = new sourceMapGenerator_js.SourceMapGenerator();\n  const generated = {\n    line: 1,\n    column: 0\n  };\n  const original = {\n    line: 0,\n    // should be zero to add first mapping\n    column: 0\n  };\n  const activatedGenerated = {\n    line: 1,\n    column: 0\n  };\n  const activatedMapping = {\n    generated: activatedGenerated\n  };\n  let line = 1;\n  let column = 0;\n  let sourceMappingActive = false;\n  const origHandlersNode = handlers.node;\n  handlers.node = function (node) {\n    if (node.loc && node.loc.start && trackNodes.has(node.type)) {\n      const nodeLine = node.loc.start.line;\n      const nodeColumn = node.loc.start.column - 1;\n      if (original.line !== nodeLine || original.column !== nodeColumn) {\n        original.line = nodeLine;\n        original.column = nodeColumn;\n        generated.line = line;\n        generated.column = column;\n        if (sourceMappingActive) {\n          sourceMappingActive = false;\n          if (generated.line !== activatedGenerated.line || generated.column !== activatedGenerated.column) {\n            map.addMapping(activatedMapping);\n          }\n        }\n        sourceMappingActive = true;\n        map.addMapping({\n          source: node.loc.source,\n          original,\n          generated\n        });\n      }\n    }\n    origHandlersNode.call(this, node);\n    if (sourceMappingActive && trackNodes.has(node.type)) {\n      activatedGenerated.line = line;\n      activatedGenerated.column = column;\n    }\n  };\n  const origHandlersEmit = handlers.emit;\n  handlers.emit = function (value, type, auto) {\n    for (let i = 0; i < value.length; i++) {\n      if (value.charCodeAt(i) === 10) {\n        // \\n\n        line++;\n        column = 0;\n      } else {\n        column++;\n      }\n    }\n    origHandlersEmit(value, type, auto);\n  };\n  const origHandlersResult = handlers.result;\n  handlers.result = function () {\n    if (sourceMappingActive) {\n      map.addMapping(activatedMapping);\n    }\n    return {\n      css: origHandlersResult(),\n      map\n    };\n  };\n  return handlers;\n}\nexports.generateSourceMap = generateSourceMap;","map":null,"metadata":{},"sourceType":"script","externalDependencies":[]}