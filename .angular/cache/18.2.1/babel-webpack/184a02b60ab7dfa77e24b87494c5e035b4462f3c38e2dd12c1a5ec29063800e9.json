{"ast":null,"code":"'use strict';\n\nconst {\n  attrsGroups\n} = require('./_collections');\nexports.name = 'convertStyleToAttrs';\nexports.description = 'converts style to attributes';\n\n/**\n * @type {(...args: string[]) => string}\n */\nconst g = (...args) => {\n  return '(?:' + args.join('|') + ')';\n};\nconst stylingProps = attrsGroups.presentation;\nconst rEscape = '\\\\\\\\(?:[0-9a-f]{1,6}\\\\s?|\\\\r\\\\n|.)'; // Like \\\" or \\2051. Code points consume one space.\nconst rAttr = '\\\\s*(' + g('[^:;\\\\\\\\]', rEscape) + '*?)\\\\s*'; // attribute name like ‘fill’\nconst rSingleQuotes = \"'(?:[^'\\\\n\\\\r\\\\\\\\]|\" + rEscape + \")*?(?:'|$)\"; // string in single quotes: 'smth'\nconst rQuotes = '\"(?:[^\"\\\\n\\\\r\\\\\\\\]|' + rEscape + ')*?(?:\"|$)'; // string in double quotes: \"smth\"\nconst rQuotedString = new RegExp('^' + g(rSingleQuotes, rQuotes) + '$');\n// Parentheses, E.g.: url(data:image/png;base64,iVBO...).\n// ':' and ';' inside of it should be treated as is. (Just like in strings.)\nconst rParenthesis = '\\\\(' + g('[^\\'\"()\\\\\\\\]+', rEscape, rSingleQuotes, rQuotes) + '*?' + '\\\\)';\n// The value. It can have strings and parentheses (see above). Fallbacks to anything in case of unexpected input.\nconst rValue = '\\\\s*(' + g('[^!\\'\"();\\\\\\\\]+?', rEscape, rSingleQuotes, rQuotes, rParenthesis, '[^;]*?') + '*?' + ')';\n// End of declaration. Spaces outside of capturing groups help to do natural trimming.\nconst rDeclEnd = '\\\\s*(?:;\\\\s*|$)';\n// Important rule\nconst rImportant = '(\\\\s*!important(?![-(\\\\w]))?';\n// Final RegExp to parse CSS declarations.\nconst regDeclarationBlock = new RegExp(rAttr + ':' + rValue + rImportant + rDeclEnd, 'ig');\n// Comments expression. Honors escape sequences and strings.\nconst regStripComments = new RegExp(g(rEscape, rSingleQuotes, rQuotes, '/\\\\*[^]*?\\\\*/'), 'ig');\n\n/**\n * Convert style in attributes. Cleanups comments and illegal declarations (without colon) as a side effect.\n *\n * @example\n * <g style=\"fill:#000; color: #fff;\">\n *             ⬇\n * <g fill=\"#000\" color=\"#fff\">\n *\n * @example\n * <g style=\"fill:#000; color: #fff; -webkit-blah: blah\">\n *             ⬇\n * <g fill=\"#000\" color=\"#fff\" style=\"-webkit-blah: blah\">\n *\n * @author Kir Belevich\n *\n * @type {import('./plugins-types').Plugin<'convertStyleToAttrs'>}\n */\nexports.fn = (_root, params) => {\n  const {\n    keepImportant = false\n  } = params;\n  return {\n    element: {\n      enter: node => {\n        if (node.attributes.style != null) {\n          // ['opacity: 1', 'color: #000']\n          let styles = [];\n          /**\n           * @type {Record<string, string>}\n           */\n          const newAttributes = {};\n\n          // Strip CSS comments preserving escape sequences and strings.\n          const styleValue = node.attributes.style.replace(regStripComments, match => {\n            return match[0] == '/' ? '' : match[0] == '\\\\' && /[-g-z]/i.test(match[1]) ? match[1] : match;\n          });\n          regDeclarationBlock.lastIndex = 0;\n          for (var rule; rule = regDeclarationBlock.exec(styleValue);) {\n            if (!keepImportant || !rule[3]) {\n              styles.push([rule[1], rule[2]]);\n            }\n          }\n          if (styles.length) {\n            styles = styles.filter(function (style) {\n              if (style[0]) {\n                var prop = style[0].toLowerCase(),\n                  val = style[1];\n                if (rQuotedString.test(val)) {\n                  val = val.slice(1, -1);\n                }\n                if (stylingProps.has(prop)) {\n                  newAttributes[prop] = val;\n                  return false;\n                }\n              }\n              return true;\n            });\n            Object.assign(node.attributes, newAttributes);\n            if (styles.length) {\n              node.attributes.style = styles.map(declaration => declaration.join(':')).join(';');\n            } else {\n              delete node.attributes.style;\n            }\n          }\n        }\n      }\n    }\n  };\n};","map":null,"metadata":{},"sourceType":"script","externalDependencies":[]}